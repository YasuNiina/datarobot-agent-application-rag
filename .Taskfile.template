---
# File generated by DataRobot CLI, regenerate using `dr task compose`
version: '3'
env:
  ENV: testing
dotenv: ['.env', '.env.{{`{{.ENV}}`}}']

includes:
  common:
    taskfile: ./core/task-common.yaml
    internal: true
  {{- range .Includes }}
  {{- if ne .Name "tests" }}
  {{ .Name }}:
    taskfile: {{ .Taskfile }}
    dir: {{ .Dir }}
  {{- end }}
  {{- end }}

tasks:
  default:
    desc: "â„¹ï¸ Show all available tasks (run `task --list-all` to see hidden tasks)"
    silent: true
    cmds:
      - task --list --sort none

  start:
    desc: "ğŸ’» Prepare local development environment"
    cmds:
      - dr self update
      - dr dotenv setup --if-needed
      - dr dotenv update
      - task install
      - dr task run start
      - echo 'âœ… You are all set. Run `task dev` to start developing, or run `task deploy` to deploy to DataRobot.'

  {{- if .HasLint }}
  lint:
    desc: "ğŸ§¹ Run linters"
    cmds:
      - dr task run lint
  {{- end }}

  {{- if .HasInstall }}
  install:
    desc: "ğŸ› ï¸ Install all dependencies"
    cmds:
      - dr task run install
  {{- end }}

  {{- if .HasTest }}
  test:
    desc: "ğŸ§ª Run tests across all components"
    cmds:
      - dr task run test
  {{- end }}

  auth-check:
    silent: true
    desc: "ğŸ” Check authentication prerequisites"
    cmds:
      - echo "ğŸ” Checking authentication.."
      - dr auth check

  dev:
    desc: "ğŸš€ Run all services together"
    deps:
      - auth-check
    cmds:
      - "{{`{{.UV_CMD}}`}} run dev.py"

  deploy:
    desc: "ğŸš€ Deploy all services"
    env:
      AGENT_DEPLOY: "1"
    cmds:
      - task: infra:deploy

  deploy-dev:
    desc: "ğŸš€ Deploy infrastructure and services to development"
    cmds:
      - task: infra:deploy-dev
